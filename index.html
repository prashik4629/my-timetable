<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Today's Timetable - Multi Batch</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 1em;
      box-shadow: 0 0 20px #c3c8d0;
      padding: 2em;
    }
    h1, h2 {
      text-align: center;
    }
    #liveStatus {
      background: #1e90ff;
      color: #fff;
      border-radius: 0.6em;
      padding: 1em;
      font-size: 1.2em;
      margin: 1em auto 0.3em auto;
      width: fit-content;
      min-width: 60%;
      text-align: center;
      box-shadow: 0 0 10px #e1e5ee;
      letter-spacing: 0.02em;
    }
    #batchSelector {
      text-align: center;
      margin: 1em auto 1em auto;
    }
    #batchSelector button {
      margin: 0 0.3em;
      padding: 0.5em 1.1em;
      border: none;
      background: #eceef1;
      color: #304068;
      font-size: 1em;
      border-radius: 0.8em;
      cursor: pointer;
      font-family: inherit;
      transition: background 0.2s;
    }
    #batchSelector button.active {
      background: #1e90ff;
      color: #fff;
      font-weight: 700;
    }
    #classNavigation {
      text-align: center;
      margin: 1em auto 2em auto;
      font-size: 1em;
      padding: 1em;
      max-width: 90%;
      background: #e8f0fe;
      border-radius: 1em;
      color: #222;
      box-shadow: 0 0 10px #d7def8;
      line-height: 1.5em;
    }
    #classNavigation strong {
      color: #1e90ff;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fafbfc;
      margin-bottom: 2em;
    }
    th, td {
      border: 1px solid #d1d5db;
      padding: 0.7em;
      text-align: center;
    }
    th {
      background: #eceef1;
      font-weight: 600;
    }
    tr:nth-child(even) { background: #f6f8fa; }
    @media (max-width: 700px) {
      body {padding: 3vw;}
      .container {box-shadow: none;padding: 0.5em;margin: 0.5em;max-width: 99vw;}
      h1, h2 { font-size: 1.3em; }
      #liveStatus, #classNavigation { min-width: unset;width: 98vw;font-size: 1em;padding: 0.7em 0.5em;box-shadow: none;}
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { display: none; }
      td {
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 48%;
        text-align: left;
        min-height: 48px;
        font-size: 1em;
      }
      td:before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        width: 45%;
        font-weight: bold;
        padding-left: 1em;
        color: #4473c5;
        font-size: 0.97em;
      }
      tr { margin-bottom: 1em; }
      table {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        background: transparent;
      }
    }
    button, a {min-height: 44px;min-width: 44px;font-size: 1.1em;border-radius: 0.6em;margin: 0.25em 0;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Today's Schedule</h1>
    <div id="batchSelector"></div>
    <div id="liveStatus">Checking current class...</div>
    <div id="classNavigation">
      <div><strong>Previous class:</strong> <span id="prevClass">Loading...</span></div>
      <div><strong>Current class:</strong> <span id="currentClass">Loading...</span></div>
      <div><strong>Next class:</strong> <span id="nextClass">Loading...</span></div>
    </div>
    <table id="todaySchedule">
      <thead>
        <tr>
          <th>Time</th>
          <th>Subject</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const jsToTableDay = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];

// Only labs differ. Other subjects and times stay the same.
const baseDays = [
  { day: 'Monday',    slots: [
    { time: '11:00-12:00', subject: 'Operating systems' },
    { time: '12:00-13:00', subject: 'Embedded system design' },
    { time: '13:00-14:00', subject: 'Machine learning' },
    { time: '14:00-15:00', subject: 'Recess' },
    { time: '15:00-17:00', subject: 'LAB' }
  ]},
  { day: 'Tuesday',   slots: [
    { time: '11:00-13:00', subject: 'LAB' },
    { time: '13:00-14:00', subject: 'Recess' },
    { time: '14:00-15:00', subject: 'Operating system' },
    { time: '15:00-16:00', subject: 'Digital VLSI' },
    { time: '16:00-17:00', subject: 'Image processing' }
  ]},
  { day: 'Wednesday', slots: [
    { time: '11:00-12:00', subject: 'Image processing' },
    { time: '12:00-13:00', subject: 'Recess' },
    { time: '13:00-15:00', subject: 'LAB' },
    { time: '15:00-16:00', subject: 'Embedded system design' },
    { time: '16:00-17:00', subject: 'Minor' }
  ]},
  { day: 'Thursday',  slots: [
    { time: '11:00-13:00', subject: 'LAB' },
    { time: '13:00-14:00', subject: 'Recess' },
    { time: '14:00-15:00', subject: 'Digital VLSI' },
    { time: '15:00-16:00', subject: 'Machine learning' },
    { time: '16:00-17:00', subject: 'Minor' }
  ]},
  { day: 'Friday',    slots: [
    { time: '11:00-12:00', subject: 'Embedded system design' },
    { time: '12:00-13:00', subject: 'Recess' },
    { time: '13:00-15:00', subject: 'LAB' },
    { time: '15:00-16:00', subject: 'Machine learning' },
    { time: '16:00-17:00', subject: 'Minor' }
  ]},
  { day: 'Saturday', slots: [
    { time: '10:00-11:00', subject: 'Image processing' },
    { time: '11:00-13:00', subject: 'LAB' },
    { time: '13:00-14:00', subject: 'Recess' },
    { time: '14:00-15:00', subject: 'Operating system' },
    { time: '15:00-16:00', subject: 'Digital VLSI' },
    { time: '16:00-17:00', subject: 'Minor' }
  ]}
];

// Labs for each batch [Monday, Tuesday, Wednesday, Thursday, Friday, Saturday]
const labs = {
  B1: [
    "Operating system lab", "Digital VLSI lab", "Embedded system design lab",
    "Machine learning lab", "Image processing lab", "No lab"
  ],
  B2: [
    "Embedded system design lab", "Digital VLSI lab", "Image processing lab",
    "Machine learning lab", "Operating system lab", "No lab"
  ],
  B3: [
    "Image processing lab", "Machine learning lab", "No lab",
    "Digital VLSI lab", "Embedded system design lab", "Operating system lab"
  ],
  B4: [
    "Cloud computing lab", "Machine learning lab", "Operating system lab",
    "Digital VLSI lab", "No lab", "Embedded system design lab"
  ]
};
const batches = ["B1", "B2", "B3", "B4"];

function buildTodaysData(batch, dayStr) {
  const index = baseDays.findIndex(d => d.day === dayStr);
  if(index === -1) return [];
  return baseDays[index].slots.map((slot) => {
    let subj = (slot.subject === "LAB") ? labs[batch][index] : slot.subject;
    // For B3, Wednesday: no lab, so do not show the slot at all
    if(dayStr === "Wednesday" && slot.subject === "LAB" && labs[batch][index] === "No lab") return null;
    if(dayStr === "Friday" && slot.subject === "LAB" && labs[batch][index] === "No lab") return null;
    return { time: slot.time, subject: subj };
  }).filter(Boolean);
}

/* ---------- UI Rendering and Navigation ---------- */
let currentBatch = 'B1'; // Default

function renderBatchSelector() {
  const sel = document.getElementById('batchSelector');
  sel.innerHTML = batches.map(b =>
    `<button type="button" class="${b === currentBatch ? 'active':''}" onclick="changeBatch('${b}')">${b}</button>`
  ).join(' ');
}

function renderTodaysTable() {
  const tbody = document.querySelector('#todaySchedule tbody');
  tbody.innerHTML = '';
  const today = new Date();
  const dayStr = jsToTableDay[today.getDay()];
  const data = buildTodaysData(currentBatch, dayStr);

  if(dayStr === 'Sunday' || data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="2">No classes today ðŸŽ‰</td></tr>`;
    return;
  }
  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td data-label="Time">${to12HourRange(row.time)}</td>
      <td data-label="Subject">${row.subject}</td>
    `;
    tbody.appendChild(tr);
  });
}

function to12Hour(timeStr) {
  if (!timeStr || typeof timeStr !== "string" || !timeStr.includes(":")) return timeStr || 'â€”';
  let [hour, minute] = timeStr.split(":").map(Number);
  const ampm = hour >= 12 ? "PM" : "AM";
  hour = hour % 12;
  if (hour === 0) hour = 12;
  return `${hour}:${minute.toString().padStart(2, "0")} ${ampm}`;
}
function to12HourRange(rangeStr) {
  if (!rangeStr || typeof rangeStr !== "string" || !rangeStr.includes("-")) return rangeStr || 'â€”';
  const [start, end] = rangeStr.split("-");
  return `${to12Hour(start)} â€“ ${to12Hour(end)}`;
}

function isNowInTimeRange(startTime, endTime, nowDate) {
  let [startHour, startMin] = startTime.split(':').map(Number);
  let [endHour, endMin] = endTime.split(':').map(Number);
  let start = new Date(nowDate);
  start.setHours(startHour, startMin, 0, 0);
  let end = new Date(nowDate);
  end.setHours(endHour, endMin, 0, 0);
  return nowDate >= start && nowDate < end;
}
function timeStrToMinutes(t) {
  let [h, m] = t.split(':').map(Number);
  return h*60+m;
}

function updateClassStatus() {
  let now = new Date();
  let dayStr = jsToTableDay[now.getDay()];
  const liveDiv = document.getElementById('liveStatus');
  const prevSpan = document.getElementById('prevClass');
  const currentSpan = document.getElementById('currentClass');
  const nextSpan = document.getElementById('nextClass');

  let todayClasses = buildTodaysData(currentBatch, dayStr);

  if(dayStr === 'Sunday' || todayClasses.length === 0) {
    liveDiv.textContent = "It's Sunday! Enjoy your day off ðŸ˜Š";
    prevSpan.textContent = "None";
    currentSpan.textContent = "No classes today";
    nextSpan.textContent = "No classes today";
    return;
  }

  // Sort by start time
  todayClasses.sort((a,b) => {
    let aStart = timeStrToMinutes(a.time.split('-')[0]);
    let bStart = timeStrToMinutes(b.time.split('-')[0]);
    return aStart - bStart;
  });

  let currentClass = null, prevClass = null, nextClass = null;
  let nowMinutes = now.getHours()*60 + now.getMinutes();
  for(let i=0; i<todayClasses.length; i++) {
    let [start, end] = todayClasses[i].time.split('-');
    if(isNowInTimeRange(start, end, now)) {
      currentClass = todayClasses[i];
      prevClass = i > 0 ? todayClasses[i-1] : null;
      nextClass = i < todayClasses.length-1 ? todayClasses[i+1] : null;
      break;
    }
  }
  if(!currentClass) {
    if(nowMinutes < timeStrToMinutes(todayClasses[0].time.split('-')[0])) {
      prevClass = null;
      nextClass = todayClasses[0];
    } else {
      for(let i=0; i<todayClasses.length; i++) {
        let startMin = timeStrToMinutes(todayClasses[i].time.split('-')[0]);
        let endMin = timeStrToMinutes(todayClasses[i].time.split('-')[1]);
        if(nowMinutes < startMin) {
          prevClass = i > 0 ? todayClasses[i-1] : null;
          nextClass = todayClasses[i];
          break;
        }
        if(i === todayClasses.length-1 && nowMinutes >= endMin) {
          prevClass = todayClasses[i];
          nextClass = null;
        }
      }
    }
  }
  if(currentClass) {
    liveDiv.innerHTML = `Current class: <strong>${currentClass.subject}</strong><br>(${to12HourRange(currentClass.time)})`;
  } else {
    liveDiv.textContent = "No class running right now.";
  }
  prevSpan.textContent = prevClass ? `${prevClass.subject} (${to12HourRange(prevClass.time)})` : "None";
  currentSpan.textContent = currentClass ? `${currentClass.subject} (${to12HourRange(currentClass.time)})` : "No class running now";
  nextSpan.textContent = nextClass ? `${nextClass.subject} (${to12HourRange(nextClass.time)})` : "No more classes today";
}

function renderAll() {
  renderBatchSelector();
  renderTodaysTable();
  updateClassStatus();
}
function changeBatch(b) {
  currentBatch = b;
  renderAll();
}
window.changeBatch = changeBatch; // make global for button onclick

renderAll();
setInterval(updateClassStatus, 30 * 1000);
</script>
</body>
</html>
