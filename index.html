<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Day Navigator Timetable</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background: #fff;
      border-radius: 1em;
      box-shadow: 0 0 20px #c3c8d0;
      padding: 2em;
      position: relative;
    }
    h1, h2 { text-align: center; }
    #batchSelector,
    #daySelector {
      text-align: center;
      margin: 1em auto;
    }
    #batchSelector button,
    #daySelector button {
      margin: 0 0.3em;
      padding: 0.5em 1.1em;
      border: none;
      background: #eceef1;
      color: #304068;
      font-size: 1em;
      border-radius: 0.8em;
      cursor: pointer;
      font-family: inherit;
      transition: background 0.2s;
    }
    #batchSelector button.active,
    #daySelector button.active {
      background: #1e90ff;
      color: #fff;
      font-weight: 700;
    }
    #liveStatus {
      background: #1e90ff;
      color: #fff;
      border-radius: 0.6em;
      padding: 1em;
      font-size: 1.2em;
      margin: 1em auto 0.3em auto;
      width: fit-content;
      min-width: 60%;
      text-align: center;
      box-shadow: 0 0 10px #e1e5ee;
      letter-spacing: 0.02em;
    }
    #classNavigation {
      text-align: center;
      margin: 1em auto 2em auto;
      font-size: 1em;
      padding: 1em;
      max-width: 90%;
      background: #e8f0fe;
      border-radius: 1em;
      color: #222;
      box-shadow: 0 0 10px #d7def8;
      line-height: 1.5em;
    }
    #classNavigation strong {
      color: #1e90ff;
    }
    .datetime-stylish {
      position: absolute;
      top: 24px;
      right: 28px;
      background: linear-gradient(90deg, #93caf9 0%, #e5efff 100%);
      color: #184d8e;
      font-weight: 600;
      font-size: 1em;
      border-radius: 1em;
      padding: 0.6em 1em;
      box-shadow: 0 1px 8px #b6dbff;
      letter-spacing: 0.04em;
      z-index: 10;
      font-family: 'Fira Mono', 'Menlo', 'Consolas', monospace;
      min-width: 180px;
      text-align: right;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      background: #fafbfc;
      margin-bottom: 2em;
    }
    th, td {
      border: 1px solid #d1d5db;
      padding: 0.7em;
      text-align: center;
    }
    th {
      background: #eceef1;
      font-weight: 600;
    }
    tr:nth-child(even) { background: #f6f8fa; }
    @media (max-width: 700px) {
      body {padding: 3vw;}
      .container {box-shadow: none;padding: 0.5em;margin: 0.5em;max-width: 99vw;}
      h1, h2 { font-size: 1.3em; }
      #liveStatus, #classNavigation { min-width: unset;width: 98vw;font-size: 1em;padding: 0.7em 0.5em;box-shadow: none;}
      .datetime-stylish {position: static;display: block;text-align: center;margin: 0 0 0.7em 0;}
      table, thead, tbody, th, td, tr { display: block; }
      thead tr { display: none; }
      td {
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 48%;
        text-align: left;
        min-height: 48px;
        font-size: 1em;
      }
      td:before {
        content: attr(data-label);
        position: absolute;
        left: 0;
        width: 45%;
        font-weight: bold;
        padding-left: 1em;
        color: #4473c5;
        font-size: 0.97em;
      }
      tr { margin-bottom: 1em; }
      table {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        background: transparent;
      }
    }
    button, a {min-height: 44px;min-width: 44px;font-size: 1.1em;border-radius: 0.6em;margin: 0.25em 0;}
  </style>
</head>
<body>
  <div class="container">
    <div id="dateTimeDisplay" class="datetime-stylish"></div>
    <h1>Day-wise Timetable</h1>
    <div id="batchSelector"></div>
    <div id="daySelector"></div>
    <div id="liveStatus">Checking class status...</div>
    <div id="classNavigation">
      <div><strong>Previous class:</strong> <span id="prevClass">Loading...</span></div>
      <div><strong>Current class:</strong> <span id="currentClass">Loading...</span></div>
      <div><strong>Next class:</strong> <span id="nextClass">Loading...</span></div>
    </div>
    <table id="todaySchedule">
      <thead>
        <tr>
          <th>Time</th>
          <th>Subject</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const jsToTableDay = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
const allDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
const batches = ["B1", "B2", "B3", "B4"];

// Updated timetable per your requirements
const baseDays = [
  { day: 'Monday', slots: [
    { time: '11:00-12:00', subject: 'Operating systems' },
    { time: '12:00-13:00', subject: 'Embedded system design' },
    { time: '13:00-14:00', subject: 'Machine learning' },
    { time: '14:00-15:00', subject: 'Recess' },
    { time: '15:00-17:00', subject: 'LAB' }
  ]},
  { day: 'Tuesday', slots: [
    { time: '10:00-11:00', subject: 'Embedded system design' },
    { time: '11:00-13:00', subject: 'LAB' },
    { time: '13:00-14:00', subject: 'Recess' },
    { time: '14:00-15:00', subject: 'Operating System' },
    { time: '15:00-16:00', subject: 'Digital VLSI' }, // Updated slot
    { time: '16:00-17:00', subject: 'Image processing / Cloud computing' }
  ]},
  { day: 'Wednesday', slots: [
    { time: '10:00-11:00', subject: 'Digital VLSI' },
    { time: '11:00-12:00', subject: 'Image processing / Cloud computing' },
    { time: '12:00-13:00', subject: 'Recess' },
    { time: '13:00-15:00', subject: 'LAB' },
    { time: '16:00-17:00', subject: 'Minor' }
  ]},
  { day: 'Thursday', slots: [
    { time: '10:00-11:00', subject: 'Image Processing' },
    { time: '11:00-13:00', subject: 'LAB' },
    { time: '13:00-14:00', subject: 'Recess' },
    { time: '14:00-15:00', subject: 'Digital VLSI' },
    { time: '15:00-16:00', subject: 'Machine learning' }, // Changed this slot
    { time: '16:00-17:00', subject: 'Minor' }
  ]},
  { day: 'Friday', slots: [
    { time: '10:00-11:00', subject: 'Operating system' },
    { time: '11:00-12:00', subject: 'Embedded system design' },
    { time: '12:00-13:00', subject: 'Recess' },
    { time: '13:00-15:00', subject: 'LAB' },
    { time: '15:00-16:00', subject: 'Machine learning' },
    { time: '16:00-17:00', subject: 'Minor' }
  ]},
  { day: 'Saturday', slots: [
    { time: '10:00-11:00', subject: 'Cloud computing' },
    { time: '11:00-13:00', subject: 'LAB' },
    { time: '16:00-17:00', subject: 'Minor' }
  ]}
];

// Labs assignments per batch and day
const labs = {
  B1: {
    Monday: "Operating system lab",
    Tuesday: "Digital VLSI lab",
    Wednesday: "Embedded system design lab",
    Thursday: "Machine learning lab",
    Friday: "Image processing lab",
    Saturday: "No lab"
  },
  B2: {
    Monday: "Embedded system design lab",
    Tuesday: "Digital VLSI lab",
    Wednesday: "Image processing lab",
    Thursday: "Machine learning lab",
    Friday: "Operating system lab",
    Saturday: "No lab"
  },
  B3: {
    Monday: "Image processing lab",
    Tuesday: "Machine learning lab",
    Wednesday: "No lab",
    Thursday: "Digital VLSI lab",
    Friday: "Embedded system design lab",
    Saturday: "Operating system lab"
  },
  B4: {
    Monday: "Cloud computing lab",
    Tuesday: "Machine learning lab",
    Wednesday: "Operating system lab",
    Thursday: "Digital VLSI lab",
    Friday: "No lab",
    Saturday: "Embedded system design lab"
  }
};

// Thursday LAB assignment as per instruction
function getThursdayLab(batch) {
  if (batch === "B1" || batch === "B2") return "Machine learning lab";
  if (batch === "B3" || batch === "B4") return "Digital VLSI lab";
  return "No lab";
}

let currentBatch = "B1";
let currentDay = (function () {
  const today = new Date();
  return jsToTableDay[today.getDay()];
})();

function renderBatchSelector() {
  const sel = document.getElementById("batchSelector");
  sel.innerHTML = batches
    .map(
      (b) =>
        `<button type="button" class="${
          b === currentBatch ? "active" : ""
        }" onclick="changeBatch('${b}')">${b}</button>`
    )
    .join(" ");
}

function renderDaySelector() {
  const sel = document.getElementById("daySelector");
  sel.innerHTML = allDays
    .map(
      (d) =>
        `<button type="button" class="${
          d === currentDay ? "active" : ""
        }" onclick="changeDay('${d}')">${d}</button>`
    )
    .join(" ");
}

function buildDayData(batch, dayStr) {
  const base = baseDays.find((d) => d.day === dayStr);
  if (!base) return [];
  return base.slots
    .map((slot) => {
      if (slot.subject === "LAB") {
        let lab = "No lab";
        if (dayStr === "Thursday") {
          lab = getThursdayLab(batch);
        } else {
          lab = labs[batch][dayStr] || "No lab";
        }
        if (lab === "No lab") return null;
        return { time: slot.time, subject: lab };
      }
      return { time: slot.time, subject: slot.subject };
    })
    .filter(Boolean);
}

function renderDayTable() {
  const tbody = document.querySelector("#todaySchedule tbody");
  tbody.innerHTML = "";
  const data = buildDayData(currentBatch, currentDay);
  if (currentDay === "Sunday" || data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="2">No classes for ${currentDay} ðŸŽ‰</td></tr>`;
    return;
  }
  data.forEach((row) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td data-label="Time">${to12HourRange(row.time)}</td>
      <td data-label="Subject">${row.subject}</td>
    `;
    tbody.appendChild(tr);
  });
}

function to12Hour(timeStr) {
  if (!timeStr || typeof timeStr !== "string" || !timeStr.includes(":"))
    return timeStr || "â€”";
  let [hour, minute] = timeStr.split(":").map(Number);
  const ampm = hour >= 12 ? "PM" : "AM";
  hour = hour % 12;
  if (hour === 0) hour = 12;
  return `${hour}:${minute.toString().padStart(2, "0")} ${ampm}`;
}

function to12HourRange(rangeStr) {
  if (!rangeStr || typeof rangeStr !== "string" || !rangeStr.includes("-"))
    return rangeStr || "â€”";
  const [start, end] = rangeStr.split("-");
  return `${to12Hour(start)} â€“ ${to12Hour(end)}`;
}

function isNowInTimeRange(startTime, endTime, nowDate) {
  const [startHour, startMin] = startTime.split(":").map(Number);
  const [endHour, endMin] = endTime.split(":").map(Number);
  const start = new Date(nowDate);
  start.setHours(startHour, startMin, 0, 0);
  const end = new Date(nowDate);
  end.setHours(endHour, endMin, 0, 0);
  return nowDate >= start && nowDate < end;
}

function timeStrToMinutes(t) {
  const [h, m] = t.split(":").map(Number);
  return h * 60 + m;
}

function updateClassStatus() {
  const now = new Date();
  const dayStr = currentDay;
  const liveDiv = document.getElementById("liveStatus");
  const prevSpan = document.getElementById("prevClass");
  const currentSpan = document.getElementById("currentClass");
  const nextSpan = document.getElementById("nextClass");

  const todayClasses = buildDayData(currentBatch, dayStr);

  if (dayStr === "Sunday" || todayClasses.length === 0) {
    liveDiv.textContent = `No classes for ${dayStr}! Enjoy your day off ðŸ˜Š`;
    prevSpan.textContent = "None";
    currentSpan.textContent = "No classes today";
    nextSpan.textContent = "No classes today";
    return;
  }

  todayClasses.sort((a, b) => {
    const aStart = timeStrToMinutes(a.time.split("-")[0]);
    const bStart = timeStrToMinutes(b.time.split("-")[0]);
    return aStart - bStart;
  });

  let currentClass = null,
    prevClass = null,
    nextClass = null;
  const nowMinutes = now.getHours() * 60 + now.getMinutes();

  for (let i = 0; i < todayClasses.length; i++) {
    const [start, end] = todayClasses[i].time.split("-");
    if (isNowInTimeRange(start, end, now)) {
      currentClass = todayClasses[i];
      prevClass = i > 0 ? todayClasses[i - 1] : null;
      nextClass = i < todayClasses.length - 1 ? todayClasses[i + 1] : null;
      break;
    }
  }

  if (!currentClass) {
    if (nowMinutes < timeStrToMinutes(todayClasses[0].time.split("-")[0])) {
      prevClass = null;
      nextClass = todayClasses[0];
    } else {
      for (let i = 0; i < todayClasses.length; i++) {
        const startMin = timeStrToMinutes(todayClasses[i].time.split("-")[0]);
        const endMin = timeStrToMinutes(todayClasses[i].time.split("-")[1]);
        if (nowMinutes < startMin) {
          prevClass = i > 0 ? todayClasses[i - 1] : null;
          nextClass = todayClasses[i];
          break;
        }
        if (i === todayClasses.length - 1 && nowMinutes >= endMin) {
          prevClass = todayClasses[i];
          nextClass = null;
        }
      }
    }
  }

  if (currentClass) {
    liveDiv.innerHTML = `Current class: <strong>${currentClass.subject}</strong><br>(${to12HourRange(
      currentClass.time
    )})`;
  } else {
    liveDiv.textContent = "No class running right now.";
  }

  prevSpan.textContent = prevClass
    ? `${prevClass.subject} (${to12HourRange(prevClass.time)})`
    : "None";
  currentSpan.textContent = currentClass
    ? `${currentClass.subject} (${to12HourRange(currentClass.time)})`
    : "No class running now";
  nextSpan.textContent = nextClass
    ? `${nextClass.subject} (${to12HourRange(nextClass.time)})`
    : "No more classes today";
}

function renderDateTimeStylish() {
  const el = document.getElementById("dateTimeDisplay");
  if (!el) return;
  const now = new Date();
  const options = {
    weekday: "long",
    year: "numeric",
    month: "long",
    day: "numeric",
  };
  const dateStr = now.toLocaleDateString(undefined, options);
  const timeStr = now.toLocaleTimeString(undefined, {
    hour: "2-digit",
    minute: "2-digit",
    hour12: true,
  });
  el.textContent = `${dateStr} | ${timeStr}`;
}

function renderAll() {
  renderBatchSelector();
  renderDaySelector();
  renderDateTimeStylish();
  renderDayTable();
  updateClassStatus();
}

function changeBatch(b) {
  currentBatch = b;
  renderAll();
}

function changeDay(d) {
  currentDay = d;
  renderAll();
}

window.changeBatch = changeBatch;
window.changeDay = changeDay;

// Initial render
renderAll();
setInterval(updateClassStatus, 30 * 1000);
setInterval(renderDateTimeStylish, 5 * 1000);
</script>
</body>
</html>
